###### 文件和文件系统的抽象

十个基本系统调用：

* open / close / [create]
* read / write / lseek / [tell]
* fstat / ftruncate
* unlink / mkdir / dup

文件系统可抽象为映射，`map<string, file>`，from filepath to file。

```cpp
struct file
{
    mode(permissions, type), size, user, group,
    timestamps(atime, mtime, ctime),
    content(bytes)
};
```

Unix文件系统使用`inode`做为文件路径和真实文件间的桥梁。

1. `map<string, inode_number>`，不同路径可映射同一个inode，inode相同的情况称为硬链接。
2. `map<inode_number, file>`，inode唯一，索引真实文件。

###### 磁盘的抽象

现代磁盘的扇区大小通常为4KB。

```cpp
class disk  // 以扇区为单位读写 
{
    // Logical Block Addressing
    read_sector(long n, void* buf);
    write_sector(long n, const void* buf);
};
```

将物理存储设备抽象为块设备。

```cpp
class block_device
{
    // 线性连续的块
    read_block(long n, void* buf);
    write_block(long n, const void* buf);
};
```

