`Mat`类表示单通道或多通道的多维数组，常用于存储图像数据。

`Mat`对象的实际存放的数据可通过`data`访问，数据布局由`step`数组定义，对于二维对象 M来说，$$addr(M_{i,j}) = M.data + M.step[0]*i + M.step[1]*j $$。

---

###### 类型

深度：存储单元的类型。使用`depth()`获取图像深度的枚举值。

通道：每个像素点包含的存储单元数量。使用`channels()`获取图像通道数量。

在创建`Mat`对象时，需要传入其类型参数，opencv预定义了一些类型，常见的有：

1. `CV_8UC1`，8位单通道矩阵。
2. `CV_8UC3`，8位三通道矩阵。
3. `CV_32FC3`，32位浮点三通道矩阵。

###### 尺寸

`Mat`对象的尺寸是以像素为单位进行计算的。通过公共成员`size`、`cols`和`rows`可以得到尺寸信息。

###### 拷贝

使用拷贝控制函数时，`Mat`对象进行浅拷贝。

使用`copyTo(dst)`或`clone()`进行深拷贝。

###### 赋值

可直接使用数值赋值给`Mat`，这样会修改所有像素的第一个通道。如果需要修改所有通道，可传入`Scalar`对象。

```cpp
int main()
{
    cv::Mat mat = cv::Mat::zeros(cv::Size(1, 1), CV_8UC3);
    
    mat = 10;
    std::cout << mat; // [10, 0, 0]

    mat = cv::Scalar(10, 20, 30);
    std::cout << mat; // [10, 20, 30]

    return 0;
}
```

###### 像素访问

使用`at<>(row, col)`模板函数访问`Mat`对象的像素点。

1. 对于单通道图像，模板类型直接使用基本类型即可，如对于8位单通道图像，使用`uchar`。
2. 对于多通道类型，模板类型需要使用`cv::Vec_`，如对于8位三通道图像，使用`cv::Vec3b`。

```cpp
int main()
{
    cv::Mat gray_mat = cv::Mat::zeros(200, 200, CV_8UC1);  // 单通道灰度图
    cv::Mat color_mat = cv::Mat::zeros(200, 200, CV_8UC3); // 三通道彩色图

    for (int i = 0; i < 200; ++i)
    {
        for (int j = 0; j < 200; ++j)
        {
            gray_mat.at<uchar>(i, j) = rand() % 255;
            color_mat.at<cv::Vec3b>(i, j) = cv::Vec3b(rand() % 255, rand() % 255, rand() % 255);
        }
    }

    cv::imshow("gray_mat", gray_mat);
    cv::imshow("color_mat", color_mat);
    cv::waitKey();

    return 0;
}
```

也可通过`data`指针直接访问像素，效率更高。

```cpp
int main()
{
    cv::Mat mat = cv::imread("./test.jpg");
    cv::imshow("img_before", mat);

    // 像素取反
    uchar *pix = mat.data;
    for (int i = 0; i < mat.rows; ++i)
        for (int j = 0; j < mat.cols; ++j)
            for (int k = 0; k < mat.channels(); ++k)
                *(pix++) = 255 - *pix;

    cv::imshow("img_after",mat);
    cv::waitKey();

    return 0;
}
```



