#### async

调用`std::async()`执行异步任务，返回与任务关联的`future`对象。

调用后，有两种执行任务的策略，C++会根据运行时条件自行选择，也可传入策略参数。

1. `std::launch::async`。创建新线程立即执行任务。
2. `std::launch::deferred`。请求任务的结果时，在调用线程执行任务（惰性求值）。

---

#### future

`future`提供访问异步任务结果的机制，其可存放异步任务的返回值，也可存放异步任务抛出的异常。其返回结果只能访问一次，如果需要多次访问或共享返回值，使用`shared_future`。

`future`保存的对象必须可移动。

###### 结果

使用`get()`阻塞等待异步任务的结果。

1. 调用前，如果对象无效，行为未定义。
2. 调用后，对象被设置为无效状态。
3. 如果异步任务抛出异常，`get()`也抛出异常。

使用`wait()`、`wait_for()`和`wiat_until()`等待结果有效。

###### 状态

使用`valid()`判断当前对象是否有效。

---

#### promise

`promise`管理`future`对象，在适合时可以设置`future`的结果或异常。其不可拷贝，可移动，一般用于线程间的数据传递。`promise`对象只能使用一次。

使用`get_future()`获取其关联的`future`对象。

使用`set_value()`或`set_exception()`设置其关联`future`对象的结果。也可使用`set_xxx_at_thread_exit()`版本，其只会在线程结束时才发送通知。

```mermaid
sequenceDiagram

participant ThreadA
participant ThreadB

ThreadA->>ThreadA:创建promise对象
ThreadA->>ThreadA:get_future()获取关联的future对象
ThreadA->>ThreadB:创建ThreadB，且将promise移交给ThreadB
ThreadA-->>ThreadA:做一些其他工作
ThreadA->>ThreadA:阻塞在get()
ThreadB->>ThreadB:做一些其他工作后，set_value()
ThreadA->>ThreadA:得到ThreadB返回的结果
```
